# Yarn berry workspace를 활용한 프론트엔드 모노레포 구축기

- https://techblog.woowahan.com/7976/

- 프론트엔드 개발 환경을 개선하기 위해 고민했던 모노레포 기술과 구축했던 경험을 공유하려고 합니다.

## Background

- 백오피스 FE 애플리케이션은 BE 엔지니어의 유산으로 각 서버 repository에서 관리되고 있습니다.
- BE 엔지니어는 필요에 따라 FE 애플리케이션 소스를 수정하지만 이것을 인지하기 어렵습니다.
- 각 백오피스 FE 애플리케이션의 기술 스택은 서로 다릅니다.
- 이미 deprecated된 기술도 여전히 사용하고 있으며 전사 표준 기술 스택과도 동떨어져 있습니다.
- 코드 컨벤션 또한 찾아보기 어렵습니다.
- FE 애플리케이션 소스의 코드 정적검사 및 테스팅이 충분하지 않습니다.

여러 레포지토리를 넘나들고 여러 기술 스택을 초월하며 시간이 지날 수록 업무 효율이 점점 감소합니다.

## 프론트엔드라는 불모지 개척을 위한 노력

- 가장 먼저 백오피스 FE 애플리케이션에 공통으로 사용되는 UI 컴포넌트들을 모은 라이브러리를 개발했습니다.
- 코드의 재사용성을 확보한 뒤에는 뒤떨어진 기술 스택을 전사 표준에 맞출 수 있도록 React, Typescript로 포팅하는 작업을 진행했습니다.
- 이를 통해 코드 베이스는 더 건강해졌고 통일된 기술 스택으로 개발 환경 또한 부분적으로 개선되었습니다. 그러나 백오피스 FE 애플리케이션 소스코드가 서로 다른 repository에 파편화되어 있고, FE 소스 변경을 일일이 확인하기 어려운 상황은 여전히 숙제로 남아있었습니다.
- 다른 repository에 파편화되어있고 FE소스 변경을 일일이 확인하기 어려운 상황이 남아있었습니다.
  - 이를 해결하기 위해 모노레포라는 카드를 꺼냅니다.

## 왜 모노레포 일까?

- 모노레포란 같은 레포지토리에서 서로 다른 프로젝트들을 관리하는 소프트웨어 개발 전략을 말합니다.
- 프로젝트를 서로 다른 레포지토리에서 관리하는 전략과 비교했을 때 코드 재사용, 외부 의존성 관리, 모든 프로젝트를 아우르는 리팩토링 측면에서 장점이 있습니다.
  - 소수의 FE 엔지니어가 다수의 FE 프로젝트를 개발 및 운영해야 하는 상황에 놓여있었습니다. 모노레포의 장점을 통해 이런 상황에서 업무의 효율을 향상시킬 수 있을 것이라고 판단하였습니다.
  - 소수의 FE 엔지니어가 다수의 FE 프로젝트를 개발, 운영하는 상황에서 장점을 발휘합니다.
- 소스의 변경사항을 한곳에 관리함으로써 한눈에 파악하기 쉽고 일관된 개발환경 세팅 비용을 줄이며, 공통 UI컴포넌트 라이브러리, 모듈화된 코드를 여러 프로젝트에서 재사용할 수 있을 것으로 기대했습니다.
- 마지막으로 코드 정적 분석 및 테스트 도구를 공통으로 적용함으로써 코드의 최소 품질을 유지할 수 있을것이라 기대했습니다.
- 다만 프로젝트 배포 파이프라인 등 구성도 변경해야 한다는 점 등 우려되는 부분도 존재하였습니다.

## 도구 정하기

- yarn(v1) + lerna, npm workspace, yarn berry workspace
  - 하지만 저희가 선택한 건 yarn berry(v2+) workspace였습니다.
- 첫 번째 이유는 yarn berry 자체였습니다. 이전에 백오피스 애플리케이션을 React + Typescript로 포팅 할 때 yarn berry를 도입한 상태였는데, 이때 yarn berry의 장점을 많이 체감했습니다. 특히 <b>Zero-install<b/>을 모노레포에서도 그대로 활용할 수 있었던 건 무시하기 어려운 yarn berry만의 장점이었습니다.

## My Opinion

- 내가 모노레포를 적용한 이유는 유틸성, 인터페이스 추가와 같이 프로젝트와 관련되지 않는 부분까지 빌드, 테스트가 진행함으로 인해 CI 빌드, 테스트 시간이 다소 오래 걸리고 필요한 패키지 부분만 빌드, 테스트할 수 있는 방법이 무엇일까에 대한 고민에 의한것과 달리 다른 목적에 의해 사용한듯 싶습니다.
- 그러기에 모노레포 선정 기준이 패키지별 빌드, 테스트를 분산화, 캐싱할 수 있는 부분(빌드 시스템)에 포커싱이 되어있다면 nx.dev, turbo 빌드 툴에 집중되어있다면 패키지 관리 측면에선 yarn(v1) + lerna, npm workspace, pnpm workspace, yarn berry workspace로 접근 가능할 듯 싶긴합니다.
  - 사실 nx.dev, turbo와 lerna, yarn workspace의 집중하는 역할이 다르긴합니다만..
- 다만 CI/CD 파이프라인을 다시 구성해 모노레포 위에서 안전하게 코드를 통합하고 배포할 수 있는 환경을 어떻게 만들었을까?
  - 모노레포 구성 중 CI/CD 파이프라인 구성 작성이 자동화 배포로 구성한다면 가장 까다로운 부분이었었습니다. 트릴리어네어때 기억으론
